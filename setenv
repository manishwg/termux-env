#!/data/data/com.termux/files/usr/bin/bash


assert_not_root() {
	if [ $(id -u) -eq 0 ]
	then
		echo "This must NOT be run as root as it will break your environment (root will be required for nearly everything due to changed file permissions)"
		exit 1
	fi
}
assert_not_root
termux-wake-lock

if [ -e ~/.bashrc ]; then
	echo removing old '.bashrc'
	rm -rf ~/.bashrc
fi

if [ -e ~/.bash_aliases ]; then
	echo removing old '.bash_aliases'
	rm -rf ~/.bash_aliases
fi

ln -sv ~/termux-env/.bashrc ~/
ln -sv ~/termux-env/.bash_aliases ~/




# echo -e "\n #### upgrading installed packages..."
# apt update
# apt full-upgrade -y

# echo -e "\n"
# # Base pkg
# echo -e "\n #### installing python python-dev..."
# apt install -y python python-dev
# echo -e "\n #### installing clang..."
# apt install -y clang
# echo -e "\n #### installing ncurses-utils..."
# apt install -y ncurses-utils # sudo dependancy
# echo -e "\n #### upgrading pip..."
# pip install --upgrade pip
# echo -e "\n"

# # ytdl
# pip install --upgrade youtube-dl
# echo -e "\n"
# apt install -y ffmpeg
# echo -e "\n"
# apt install -y atomicparsley
# echo -e "\n"

# # saavn
# apt install -y libxml2 libxml2-dev 
# echo -e "\n"
# apt install -y libxslt libxslt-dev
# echo -e "\n"
# pip install --upgrade lxml
# echo -e "\n"
# pip install --upgrade requests
# echo -e "\n"
# pip install --upgrade mutagen
# echo -e "\n"
 



if [ -f ~/termux-env/mp4box/$(uname -m) ]; then
	ln -sv ~/termux-env/mp4box/$(uname -m) ~/termux-env/bin/mp4box
fi

devicemodel=$(getprop ro.product.model)
devicemodel=$(echo $devicemodel | sed -e "s: ::g")
echo $devicemodel
if [ -e ~/termux-env/patches/$devicemodel ]; then
	echo -e "\n #### patching ~/termux-env/patches/$devicemodel"
	bash ~/termux-env/patches/$devicemodel
else
	echo -e "\n #### no patches Linking bins"
	ln -sv ~/termux-env/topatch/bin/* ~/termux-env/bin/
fi



echo -e "\n #### Setting ~/bin"

chmod 774 ~/termux-env/bin
chmod 775 ~/termux-env/bin/*

if [[ -L ~/bin && -d ~/bin ]]
then
	echo removing previous '~/bin'
	rm -rf ~/bin
fi

cwd2=$(pwd)
cd ~
ln -sv ./termux-env/bin ~/
cd $cwd2

termux-wake-unlock